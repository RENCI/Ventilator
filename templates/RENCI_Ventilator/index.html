{% extends 'base.html' %}
{% load static %}
	{% block title %}Ventilator Dashboard{% endblock %}
	{% block content %}
		<script type="text/javascript">
			// page is rendered, load up the details from the DB
			$(document).ready(function()
			{
                const $valueSpan1 = $('.valueSpan1');
                const $value1 = $('#customRange1');
                $valueSpan1.html(25);
                $value1.on('input change', () => {
                    $valueSpan1.html($value1.val());
                });

                const $valueSpan2 = $('.valueSpan2');
                const $value2 = $('#customRange2');
                $valueSpan2.html(50);
                $value2.on('input change', () => {
                    $valueSpan2.html($value2.val());
                });

                // set the dimensions and margins of the graph
                var margin = {top: 30, right: 0, bottom: 30, left: 50},
                    width = 200 - margin.left - margin.right,
                    height = 200 - margin.top - margin.bottom;

                //Read the data
                d3.csv("{% static 'data.csv' %}",
                function(data) {
                  // group the data: I want to draw one line per group
                  var sumstat = d3.nest() // nest function allows to group the calculation per level of a factor
                    .key(function(d) { return d.name;})
                    .entries(data);

                  // What is the list of groups?
                  allKeys = sumstat.map(function(d){return d.key})

                  // Add an svg element for each group. The will be one beside each other and will go on the next row when no more room available
                  var svg = d3.select("#monitorTarget")
                    .selectAll("uniqueChart")
                    .data(sumstat)
                    .enter()
                    .append("svg")
                      .attr("width", width + margin.left + margin.right)
                      .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                      .attr("transform",
                            "translate(" + margin.left + "," + margin.top + ")");

                  // Add X axis --> it is a integer
                  var x = d3.scaleLinear()
                    .domain(d3.extent(data, function(d) { return d.xaxis; }))
                    .range([ 0, width ]);
                  svg
                    .append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).ticks(3));

                  //Add Y axis
                  var y = d3.scaleLinear()
                    .domain([0, d3.max(data, function(d) { return +d.n; })])
                    .range([ height, 0 ]);
                  svg.append("g")
                    .call(d3.axisLeft(y).ticks(5));

                  // color palette
                  var color = d3.scaleOrdinal()
                    .domain(allKeys)
                    .range(['#e41a1c','#377eb8','#4daf4a','#984ea3'])

                  // Draw the line
                  svg
                    .append("path")
                      .attr("fill", "none")
                      .attr("stroke", function(d){ return color(d.key) })
                      .attr("stroke-width", 1.9)
                      .attr("d", function(d){
                        return d3.line()
                          .x(function(d) { return x(d.xaxis); })
                          .y(function(d) { return y(+d.n); })
                          (d.values)
                      })

                  // Add titles
                  svg
                    .append("text")
                    .attr("text-anchor", "start")
                    .attr("y", -5)
                    .attr("x", 0)
                    .text(function(d){ return(d.key)})
                    .style("fill", function(d){ return color(d.key) })
                })
            })
		</script>

		<div id="cardBody" class="card-body">
			<ul class="nav nav-tabs" id="navTabs" role="tablist" style="margin-left:10px; margin-bottom: 7px">
				<li class="nav-item">
					<a data-balloon="This area is for monitoring the ventilator" data-balloon-pos="right" class="nav-link active" id="monitor-Tab" data-toggle="tab" href="#monitorTab" role="tab">Monitor</a>
				</li>

				<li class="nav-item">
                    <a data-balloon="This area is for viewing configuration items" data-balloon-pos="up" class="nav-link" id="configuration-tab" data-toggle="tab" href="#configTab" role="tab">Configuration</a>
				</li>
            </ul>

			<div class="row">
				<div class="col-md-12">
					<div class="card" style="border: 1px;">

						<div class="card-body">

                            <div id="tabContent" class="tab-content">
								<div id="monitorTab" class="tab-pane fade show active" role="tabpanel">
									<div class="row">
										<div class="col-md-12">
											<div class="card">
												<div class="card-header">
													<span data-balloon="Monitor tab." data-balloon-pos="right">Monitor</span>&nbsp;&nbsp;
												</div>

												<div id="monitorTarget" style="margin-top: 5px; margin-left: 5px"></div>
											</div>
										</div>
									</div>
								</div>

								<div id="configTab" class="tab-pane fade show" role="tabpanel">
									<div class="row">
										<div class="col-md-12">
											<div class="card">
												<div class="card-header">
													<span data-balloon="Configuration tab." data-balloon-pos="right">Configuration</span>&nbsp;&nbsp;
												</div>

                                                <div class="d-flex justify-content-center my-4">
                                                  <div class="w-75">
                                                    <label for="customRange1">Setting 1</label>
                                                    <input type="range" class="custom-range" id="customRange1" min="0" max="100">
                                                  </div>
                                                  <span class="font-weight-bold text-primary ml-2 valueSpan1"></span>
                                                </div>

                                                <div class="d-flex justify-content-center my-4">
                                                  <div class="w-75">
                                                    <label for="customRange2">Setting 2</label>
                                                    <input type="range" class="custom-range" id="customRange2" min="0" max="100">
                                                  </div>
                                                  <span class="font-weight-bold text-primary ml-2 valueSpan2"></span>
                                                </div>
											</div>
										</div>
									</div>
								</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
	{% endblock %}

